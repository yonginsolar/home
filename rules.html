<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¡°í•© ê·œì •ì§‘ - ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet"> 
  
  <style>
      /* [ìˆ˜ì •] PC/ëª¨ë°”ì¼ í—¤ë” ê°„ê²© ë° ê²€ìƒ‰ì°½ ìœ„ì¹˜ ìµœì í™” */
      body { background-color: #f8f9fa; }
      
      /* ê¸°ë³¸ í—¤ë” ìŠ¤íƒ€ì¼ ê°•ì œ (í° ë°°ê²½) */
      #header { background: #fff !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      #navbar ul li a { color: #333 !important; }
      #navbar ul li a:hover, #navbar ul li a.active { color: #009961 !important; }
      .logo h1 a { color: #333 !important; }
      
      /* ëª¨ë°”ì¼ í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ */
      .mobile-nav-toggle { color: #333 !important; cursor: pointer; }

      /* ê²€ìƒ‰ì°½ & íƒ­ ì˜ì—­ (Sticky) ìœ„ì¹˜ ì¡°ì • */
      .sticky-nav-area {
          position: sticky;
          z-index: 900;
          background: rgba(255, 255, 255, 0.98);
          border-bottom: 1px solid #eee;
          padding-top: 15px;
          padding-bottom: 10px;
          margin-bottom: 20px;
          /* PC ê¸°ì¤€ ë†’ì´ */
          top: 70px; 
      }

      /* ëª¨ë°”ì¼ì—ì„œëŠ” í—¤ë”ê°€ ì¢€ ë” ì‘ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë†’ì´ ì¡°ì • */
      @media (max-width: 991px) {
          .sticky-nav-area { top: 60px; }
      }
  </style>
</head>

<body>

  <header id="header" class="fixed-top">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="logo">
        <h1><a href="index.html">ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</a></h1>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link" href="index.html">í™ˆìœ¼ë¡œ</a></li>
          <li><a class="nav-link" href="index.html#about">ì†Œê°œ</a></li>
          <li><a class="nav-link" href="index.html#contact">ë¬¸ì˜í•˜ê¸°</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle" onclick="toggleMobileMenu()"></i>
      </nav>
    </div>
  </header>

  <div style="height: 80px;"></div>

  <div class="sticky-nav-area">
      <div class="container">
          <div class="input-group mb-2">
              <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-secondary"></i></span>
              <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ì¡°í•­ ê²€ìƒ‰ (ì˜ˆ: ì´ì‚¬íšŒ, ì¡°í•©ì›)">
          </div>

          <ul class="nav nav-pills nav-fill" id="pills-tab" role="tablist">
              <li class="nav-item">
                  <button class="nav-link active" id="pills-articles-tab" data-bs-toggle="pill" data-bs-target="#pills-articles" type="button" onclick="window.scrollTo(0,0)">ğŸ“œ ì •ê´€</button>
              </li>
              <li class="nav-item">
                  <button class="nav-link" id="pills-bylaws-tab" data-bs-toggle="pill" data-bs-target="#pills-bylaws" type="button" onclick="window.scrollTo(0,0)">âš–ï¸ ê·œì•½</button>
              </li>
          </ul>
      </div>
  </div>

  <main class="container py-3" style="min-height: 80vh;">
    <div class="tab-content" id="pills-tabContent">
        
        <div class="tab-pane fade show active" id="pills-articles">
            <div class="text-center mb-4">
                <h4 class="fw-bold">ì •ê´€ (Articles)</h4>
                <p class="text-muted small" id="articles-version">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <div id="articles-container"></div> 
            
            <div class="mt-5 pt-4 border-top">
                <h6 class="fw-bold text-muted mb-3 small">ì§€ë‚œ ê°œì • ì´ë ¥</h6>
                <div class="accordion" id="accordionArticles"></div>
            </div>
        </div>

        <div class="tab-pane fade" id="pills-bylaws">
            <div class="text-center mb-4">
                <h4 class="fw-bold">ìš´ì˜ ê·œì•½ (Bylaws)</h4>
                <p class="text-muted small" id="bylaws-version">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <div id="bylaws-container"></div> 

            <div class="mt-5 pt-4 border-top">
                <h6 class="fw-bold text-muted mb-3 small">ì§€ë‚œ ê°œì • ì´ë ¥</h6>
                <div class="accordion" id="accordionBylaws"></div>
            </div>
        </div>

    </div>
  </main>

  <footer id="footer">
    <div class="footer-top">
      <div class="container">
        <div class="row">

          <div class="col-lg-3 col-md-6 footer-contact">
            <h3>ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</h3>
            <p>
              í–‡ë¹›ì€ ëˆ„êµ¬ì—ê²Œë‚˜ ê³µí‰í•©ë‹ˆë‹¤.<br>
              ì‹œë¯¼ì˜ í˜ìœ¼ë¡œ ë§Œë“œëŠ”<br>
              ê¹¨ë—í•œ ì—ë„ˆì§€ ì„¸ìƒ.
            </p>
          </div>

          <div class="col-lg-2 col-md-6 footer-links">
            <h4>ë°”ë¡œê°€ê¸°</h4>
            <ul>
              <li><i class="bi bi-chevron-right"></i> <a href="index.html#hero">í™ˆ</a></li>
              <li><i class="bi bi-chevron-right"></i> <a href="index.html#about">ì¡°í•© ì†Œê°œ</a></li>
              <li><i class="bi bi-chevron-right"></i> <a href="index.html#progress">ë°œì „ í˜„í™©</a></li>
              <li><i class="bi bi-chevron-right"></i> <a href="index.html#contact">ë¬¸ì˜í•˜ê¸°</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-6 footer-links">
            <h4>ì •ë³´ ë° ì •ì±…</h4>
            <ul>
                <li><i class="bi bi-chevron-right"></i> <a href="index.html" onclick="alert('ë©”ì¸ í˜ì´ì§€ í•˜ë‹¨ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.')">ì´ìš©ì•½ê´€</a></li>
              <li><i class="bi bi-chevron-right"></i> <a href="index.html" onclick="alert('ë©”ì¸ í˜ì´ì§€ í•˜ë‹¨ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.')">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-6 footer-newsletter">
            <h4>Contact Us</h4>
            <p>ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”.</p>
            <div style="color:#fff; font-size:14px; line-height:2;">
              <i class="bi bi-geo-alt me-2" style="color:var(--color-secondary)"></i> ê²½ê¸° ìš©ì¸ì‹œ ì²˜ì¸êµ¬ ë‚¨ì‚¬ì ìƒë™ë¡œ 28<br>
              <i class="bi bi-envelope me-2" style="color:var(--color-secondary)"></i> yonginsolar@gmail.com<br>
              <i class="bi bi-phone me-2" style="color:var(--color-secondary)"></i> 010-2513-5736 (ì‚¬ë¬´êµ­)<br>
              <i class="bi bi-bank me-2" style="color:var(--color-secondary)"></i> ì‹ í˜‘ 131-022-855516 ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="container d-md-flex py-4">
      <div class="me-md-auto text-center text-md-start">
        <div class="copyright">
          &copy; Copyright <strong><span>ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</span></strong>. All Rights Reserved
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    const SUPABASE_URL = 'https://ifdqlwxgqgsvnawmhlfc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmZHFsd3hncWdzdm5hd21obGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxODQ3NDIsImV4cCI6MjA4Mjc2MDc0Mn0.UKUvMOl58KuDH24seC3oSgla7mK5lr-vXjqtpalnl6k';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    window.onload = async () => {
        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ ë¡œì§
        initMobileMenu();

        await loadDocuments('ì •ê´€', 'articles');
        await loadDocuments('ê·œì•½', 'bylaws');
        
        document.getElementById('searchInput').addEventListener('input', filterContent);
        if(window.location.hash === '#bylaws') {
            const trigger = document.querySelector('#pills-bylaws-tab');
            if(trigger) new bootstrap.Tab(trigger).show();
        }
    };

    // [ì‹ ê·œ] ëª¨ë°”ì¼ ë©”ë‰´ ê¸°ëŠ¥ (í–„ë²„ê±° ë²„íŠ¼)
    function initMobileMenu() {
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡í•˜ì—¬ HTMLì—ì„œ onclickìœ¼ë¡œ ë¶€ë¥¼ ìˆ˜ ìˆê²Œ í•¨
        window.toggleMobileMenu = function() {
            const navbar = document.querySelector('#navbar');
            navbar.classList.toggle('navbar-mobile');
            const icon = document.querySelector('.mobile-nav-toggle');
            icon.classList.toggle('bi-list');
            icon.classList.toggle('bi-x'); // X ì•„ì´ì½˜ìœ¼ë¡œ ë³€ê²½
        }
    }

    async function loadDocuments(keyword, typeId) {
        const { data } = await _supabase.from('site_documents')
            .select('*').eq('category', 'doc').ilike('title', `%${keyword}%`).order('event_date', {ascending: false});

        if (!data || data.length === 0) {
            document.getElementById(`${typeId}-container`).innerHTML = '<div class="text-center py-5 text-muted">ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        let currentDoc = data.find(d => d.is_current) || data[0];
        let pastDocs = data.filter(d => d.id !== currentDoc.id);

        if (currentDoc) {
            document.getElementById(`${typeId}-version`).innerText = `ì‹œí–‰ì¼: ${currentDoc.event_date} | ë²„ì „: ${currentDoc.version || 'Original'}`;
            renderCards(currentDoc.content, `${typeId}-container`);
        }

        const archiveBox = document.getElementById(typeId === 'articles' ? 'accordionArticles' : 'accordionBylaws');
        if (pastDocs.length > 0) {
            let html = '';
            pastDocs.forEach((doc, idx) => {
                const itemId = `${typeId}Arch${idx}`;
                html += `
                    <div class="accordion-item searchable-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${itemId}">
                                ${doc.title} <span class="archive-badge">${doc.event_date}</span>
                            </button>
                        </h2>
                        <div id="${itemId}" class="accordion-collapse collapse">
                            <div class="accordion-body bg-light">
                                <div class="archive-content" style="white-space: pre-wrap; font-size:0.9rem;">${doc.content}</div>
                            </div>
                        </div>
                    </div>`;
            });
            archiveBox.innerHTML = html;
        } else {
            archiveBox.innerHTML = '<div class="text-center text-muted small py-3">ì§€ë‚œ ê°œì • ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }

    function renderCards(text, containerId) {
        const container = document.getElementById(containerId);
        if (!text) return;

        const lines = text.split('\n');
        let html = '';
        let buffer = ''; 
        let currentTitle = ''; 

        const chapterPattern = /^ì œ\s*\d+\s*ì¥/; 
        const addendaPattern = /^ë¶€\s*ì¹™/;       
        
        lines.forEach(line => {
            const trimmed = line.trim();
            if(!trimmed) return;

            if (chapterPattern.test(trimmed)) {
                if (currentTitle || buffer) flushCard();
                html += `<div class="chapter-title searchable-item">${trimmed}</div>`;
                return;
            }

            if (addendaPattern.test(trimmed)) {
                if (currentTitle || buffer) flushCard();
                html += `<div class="addenda-title searchable-item">${trimmed}</div>`;
                return;
            }

            if (trimmed.startsWith('ì œ') && trimmed.includes('ì¡°')) {
                if (currentTitle || buffer) flushCard();
                
                const splitIndex = trimmed.search(/(\(|\[|â‘ |1\.|ê°€\.)/);
                if (splitIndex > -1) {
                    const parenEnd = trimmed.indexOf(')');
                    if (parenEnd > -1 && parenEnd < trimmed.length - 1) {
                        currentTitle = trimmed.substring(0, parenEnd + 1).trim();
                        buffer = trimmed.substring(parenEnd + 1).trim();
                    } else {
                        currentTitle = trimmed; 
                        buffer = '';
                        const circleMatch = trimmed.search(/â‘ |â‘¡|â‘¢|â‘£|â‘¤|â‘¥|â‘¦|â‘§|â‘¨|â‘©/);
                        if (circleMatch > 0) {
                             currentTitle = trimmed.substring(0, circleMatch).trim();
                             buffer = trimmed.substring(circleMatch).trim();
                        }
                    }
                } else {
                    currentTitle = trimmed;
                    buffer = '';
                }
                return;
            }

            if (trimmed) {
                buffer += (buffer ? '<br>' : '') + trimmed;
            }
        });

        if (currentTitle || buffer) flushCard();

        function flushCard() {
            let formattedBody = buffer.replace(/(â‘ |â‘¡|â‘¢|â‘£|â‘¤|â‘¥|â‘¦|â‘§|â‘¨|â‘©)/g, '<br>$1');
            if(formattedBody.startsWith('<br>')) formattedBody = formattedBody.substring(4);

            html += `
            <div class="article-card searchable-item">
                ${currentTitle ? `<span class="article-title">${currentTitle}</span>` : ''}
                <div class="article-content">${formattedBody}</div>
            </div>`;
            
            currentTitle = '';
            buffer = '';
        }

        container.innerHTML = html;
    }

    function filterContent() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        const items = document.querySelectorAll('.searchable-item');

        items.forEach(item => {
            const collapseDiv = item.querySelector('.accordion-collapse');
            if (collapseDiv && !collapseDiv.classList.contains('show')) {
                item.style.display = ''; return; 
            }
            if (item.innerText.toLowerCase().includes(keyword)) item.style.display = '';
            else item.style.display = 'none';
        });
    }
  </script>
</body>
</html>
