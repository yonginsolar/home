<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì •ê´€ ë° ê·œì•½ - ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</title>
  
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet"> <style>
    body { background-color: #f8f9fa; font-family: 'Pretendard', sans-serif; padding-top: 140px; /* ê²€ìƒ‰ë°” ë†’ì´ë§Œí¼ ë„ì›€ */ }
    
    /* ìƒë‹¨ ê³ ì • í—¤ë” & ê²€ìƒ‰ë°” */
    .sticky-header {
        position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid #eee;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    .nav-pills .nav-link { color: #666; border-radius: 20px; padding: 8px 20px; font-weight: 600; }
    .nav-pills .nav-link.active { background-color: var(--color-primary, #009961); color: white; }
    
    /* ì¡°í•­ ì¹´ë“œ ë””ìì¸ */
    .article-card {
        background: white; border: 1px solid #e9ecef; border-radius: 12px;
        padding: 25px; margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        transition: transform 0.2s;
    }
    .article-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    
    .article-title { color: var(--color-primary, #009961); font-weight: 800; font-size: 1.1rem; margin-bottom: 12px; display: block; border-bottom: 2px solid #f1f3f5; padding-bottom: 8px; }
    .article-content { font-size: 1rem; line-height: 1.8; color: #444; word-break: keep-all; }
    
    /* ê²€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ */
    .highlight { background-color: #fff3cd; font-weight: bold; }

    /* ì•„ì½”ë””ì–¸ ìŠ¤íƒ€ì¼ */
    .accordion-button:not(.collapsed) { background-color: #e8f5e9; color: var(--color-primary, #009961); }
    .archive-badge { font-size: 0.7rem; padding: 4px 8px; background: #6c757d; color: white; border-radius: 4px; margin-left: 8px; }
  </style>
</head>

<body>

  <header class="sticky-header py-3">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="m-0 fw-bold"><a href="index.html" class="text-decoration-none text-dark"><i class="bi bi-arrow-left me-2"></i>ì¡°í•© ê·œì •ì§‘</a></h5>
            <small class="text-muted">í˜‘ë™ì¡°í•© ìš´ì˜ ì§€ì¹¨ì„œ</small>
        </div>
        
        <div class="input-group mb-3">
            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
            <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ì°¾ìœ¼ì‹œëŠ” ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ì‚¬íšŒ, ì¶œìê¸ˆ)">
        </div>

        <ul class="nav nav-pills nav-fill" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-articles-tab" data-bs-toggle="pill" data-bs-target="#pills-articles" type="button" onclick="window.scrollTo(0,0)">ğŸ“œ ì •ê´€ (Articles)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-bylaws-tab" data-bs-toggle="pill" data-bs-target="#pills-bylaws" type="button" onclick="window.scrollTo(0,0)">âš–ï¸ ê·œì•½ (Bylaws)</button>
            </li>
        </ul>
    </div>
  </header>

  <main class="container mb-5">
    <div class="tab-content" id="pills-tabContent">
        
        <div class="tab-pane fade show active" id="pills-articles">
            <div class="text-center py-4">
                <h3 class="fw-bold">ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•© ì •ê´€</h3>
                <p class="text-muted" id="articles-version">ë¡œë”© ì¤‘...</p>
            </div>
            <div id="articles-container"></div> <div class="mt-5 pt-5 border-top">
                <h6 class="fw-bold text-muted mb-3"><i class="bi bi-clock-history"></i> ì§€ë‚œ ì •ê´€ ë³´ê¸° (Archive)</h6>
                <div class="accordion" id="accordionArticles">
                    </div>
            </div>
        </div>

        <div class="tab-pane fade" id="pills-bylaws">
            <div class="text-center py-4">
                <h3 class="fw-bold">ìš´ì˜ ê·œì•½ ë° ê·œì •</h3>
                <p class="text-muted" id="bylaws-version">ë¡œë”© ì¤‘...</p>
            </div>
            <div id="bylaws-container"></div> <div class="mt-5 pt-5 border-top">
                <h6 class="fw-bold text-muted mb-3"><i class="bi bi-clock-history"></i> ì§€ë‚œ ê·œì•½ ë³´ê¸° (Archive)</h6>
                <div class="accordion" id="accordionBylaws"></div>
            </div>
        </div>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    const SUPABASE_URL = 'https://ifdqlwxgqgsvnawmhlfc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmZHFsd3hncWdzdm5hd21obGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxODQ3NDIsImV4cCI6MjA4Mjc2MDc0Mn0.UKUvMOl58KuDH24seC3oSgla7mK5lr-vXjqtpalnl6k';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    window.onload = async () => {
        await loadDocuments('ì •ê´€', 'articles');
        await loadDocuments('ê·œì•½', 'bylaws');
        
        // ê²€ìƒ‰ ê¸°ëŠ¥ ì—°ê²°
        document.getElementById('searchInput').addEventListener('input', filterContent);
        
        // ë©”ì¸ì—ì„œ ë„˜ì–´ì™”ì„ ë•Œ íƒ­ ìë™ ì„ íƒ (URL í•´ì‹œ #bylaws ì²´í¬)
        if(window.location.hash === '#bylaws') {
            document.querySelector('#pills-bylaws-tab').click();
        }
    };

    // DBì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadDocuments(categoryName, elementIdPrefix) {
        // categoryê°€ 'ì •ê´€' ë˜ëŠ” 'ê·œì•½' ì¸ ê²ƒ (ì œëª©ì´ë‚˜ ë‚´ìš©ì— í¬í•¨ëœ ê²ƒ ì°¾ê¸°)
        // ì—¬ê¸°ì„œëŠ” ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ categoryë¥¼ 'doc'ìœ¼ë¡œ ì €ì¥í•˜ë˜, titleì— 'ì •ê´€'/'ê·œì•½'ì´ ë“¤ì–´ê°„ë‹¤ê³  ê°€ì •í•˜ê±°ë‚˜
        // ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ category ìì²´ë¥¼ 'ì •ê´€', 'ê·œì•½'ìœ¼ë¡œ ì €ì¥í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.
        // **ì¤‘ìš”:** ì•„ê¹Œ ê´€ë¦¬ì ì½”ë“œì—ì„œ category='doc'ìœ¼ë¡œ ê³ ì •í–ˆìœ¼ë‹ˆ, titleë¡œ êµ¬ë¶„í•˜ê² ìŠµë‹ˆë‹¤.
        
        const { data } = await _supabase.from('site_documents')
            .select('*')
            .eq('category', 'doc')
            .ilike('title', `%${categoryName}%`) 
            .order('event_date', {ascending: false});

        if (!data) return;

        // 1. í˜„ì¬ ì ìš© ë²„ì „ ì°¾ê¸° (is_current = true ì¤‘ ê°€ì¥ ìµœì‹ , ì—†ìœ¼ë©´ ê·¸ëƒ¥ ê°€ì¥ ìµœì‹ )
        let currentDoc = data.find(d => d.is_current) || data[0]; 
        // 2. ê³¼ê±° ë²„ì „ë“¤
        let pastDocs = data.filter(d => d.id !== currentDoc.id);

        // [ë Œë”ë§] í˜„ì¬ ë²„ì „
        if (currentDoc) {
            document.getElementById(`${elementIdPrefix}-version`).innerText = 
                `ì‹œí–‰ì¼: ${currentDoc.event_date} | ë²„ì „: ${currentDoc.version || 'Original'}`;
            
            // â˜… ìë™ ì¹´ë“œ ë§Œë“¤ê¸° (í…ìŠ¤íŠ¸ -> ì¹´ë“œ ë³€í™˜)
            renderCards(currentDoc.content, `${elementIdPrefix}-container`);
        }

        // [ë Œë”ë§] ê³¼ê±° ë²„ì „ (ì•„ì½”ë””ì–¸)
        const archiveContainer = document.getElementById(elementIdPrefix === 'articles' ? 'accordionArticles' : 'accordionBylaws');
        if (pastDocs.length > 0) {
            pastDocs.forEach((doc, idx) => {
                const itemId = `${elementIdPrefix}Arch${idx}`;
                // ì•„ì½”ë””ì–¸ ì•„ì´í…œ ìƒì„±
                const itemHtml = `
                    <div class="accordion-item searchable-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${itemId}">
                                ${doc.title} <span class="archive-badge">${doc.event_date}</span>
                            </button>
                        </h2>
                        <div id="${itemId}" class="accordion-collapse collapse">
                            <div class="accordion-body bg-light">
                                <div class="archive-content">
                                    ${textToHtml(doc.content)}
                                </div>
                            </div>
                        </div>
                    </div>`;
                archiveContainer.innerHTML += itemHtml;
            });
        } else {
            archiveContainer.innerHTML = '<div class="text-center text-muted small py-3">ì§€ë‚œ ê°œì • ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }

    // â˜… [í•µì‹¬ ê¸°ìˆ ] í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•´ì„œ "ì œNì¡°" ë‹¨ìœ„ë¡œ ì¹´ë“œ ë§Œë“¤ê¸°
    function renderCards(text, containerId) {
        const container = document.getElementById(containerId);
        if (!text) {
            container.innerHTML = '<div class="text-center py-5">ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        // ì •ê·œì‹: "ì œ1ì¡°", "ì œ 2 ì¡°", "ì œ10ì¡°(ëª©ì )" ë“±ì„ ì°¾ìŒ
        // ì¤„ë°”ê¿ˆ(\n) ë’¤ì— ì˜¤ëŠ” 'ì œOì¡°'ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìª¼ê°­ë‹ˆë‹¤.
        const parts = text.split(/(\n|^)(?=ì œ\s*\d+\s*ì¡°)/g);
        
        let html = '';
        parts.forEach(part => {
            const trimmed = part.trim();
            if (!trimmed || trimmed === '\n') return; // ë¹ˆì¹¸ íŒ¨ìŠ¤

            // ì œëª©(ì œOì¡°...)ê³¼ ë‚´ìš© ë¶„ë¦¬
            // ì²« ë²ˆì§¸ ì¤„ë°”ê¿ˆ ì „ê¹Œì§€ê°€ ì œëª©
            const firstLineBreak = trimmed.indexOf('\n');
            let title = '';
            let body = '';

            if (firstLineBreak > -1) {
                title = trimmed.substring(0, firstLineBreak).trim();
                body = trimmed.substring(firstLineBreak).trim();
            } else {
                title = trimmed; // ë‚´ìš© ì—†ì´ ì œëª©ë§Œ ìˆëŠ” ê²½ìš°
            }

            // ì¹´ë“œê°€ ì•„ë‹ˆë©´(ì œOì¡°ë¡œ ì‹œì‘ ì•ˆ í•˜ë©´) ê·¸ëƒ¥ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ (ì„œë¬¸, ë¶€ì¹™ ë“±)
            if (!title.startsWith('ì œ')) {
                html += `<div class="article-card searchable-item">
                            <div class="article-content">${textToHtml(trimmed)}</div>
                         </div>`;
            } else {
                // ì¹´ë“œ ìƒì„±
                html += `
                <div class="article-card searchable-item">
                    <span class="article-title">${title}</span>
                    <div class="article-content">${textToHtml(body)}</div>
                </div>`;
            }
        });

        container.innerHTML = html;
    }

    // í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ -> HTML <br> ë³€í™˜
    function textToHtml(str) {
        if (!str) return '';
        return str.replace(/\n/g, '<br>');
    }

    // â˜… [ê²€ìƒ‰ ê¸°ëŠ¥] (ì•„ì½”ë””ì–¸ ë‹«í˜ ìƒíƒœ ë°˜ì˜)
    function filterContent() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        // ëª¨ë“  ê²€ìƒ‰ ëŒ€ìƒ (í˜„ì¬ ì¹´ë“œ + ì•„ì½”ë””ì–¸)
        const items = document.querySelectorAll('.searchable-item');

        items.forEach(item => {
            // ì•„ì½”ë””ì–¸ì¸ ê²½ìš°: ë‹«í˜€ìˆìœ¼ë©´(.collapseê°€ ìˆê³  .showê°€ ì—†ìŒ) ê²€ìƒ‰ ì œì™¸
            const collapseDiv = item.querySelector('.accordion-collapse');
            if (collapseDiv && !collapseDiv.classList.contains('show')) {
                // ë‹«í˜€ìˆëŠ” ì•„ì½”ë””ì–¸ì€ ê²€ìƒ‰í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ë‘  (ë³´ì´ëŠ” ìƒíƒœ ìœ ì§€)
                item.style.display = ''; 
                return; 
            }

            const text = item.innerText.toLowerCase();
            if (text.includes(keyword)) {
                item.style.display = '';
                // (ì„ íƒì‚¬í•­) í•˜ì´ë¼ì´íŠ¸ ê¸°ëŠ¥ì€ ë³µì¡í•´ì§€ë‹ˆ ìƒëµí•˜ê±°ë‚˜ í•„ìš”ì‹œ ì¶”ê°€
            } else {
                item.style.display = 'none'; // ìˆ¨ê¹€
            }
        });
    }
  </script>
</body>
</html>
