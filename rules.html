<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¡°í•© ê·œì •ì§‘ - ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</title>

    <link rel="icon" type="image/png" href="https://ifdqlwxgqgsvnawmhlfc.supabase.co/storage/v1/object/public/assets/favicon.png">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet"> 
  <style>
  /* ê²€ìƒ‰ì°½ ì˜¤ë²„ë ˆì´ */
  #search-overlay {
      display: none;
      position: fixed;
      top: 80px; /* â˜… í•µì‹¬: í—¤ë” ì•„ë˜ë¡œ ë‚´ë¦¼ */
      left: 0;
      width: 100%;
      background: #f8f9fa;
      padding: 15px 0;
      border-bottom: 1px solid #ddd;
      z-index: 998; /* í—¤ë”ë³´ë‹¤ëŠ” ì•„ë˜, ë³¸ë¬¸ë³´ë‹¤ëŠ” ìœ„ */
      box-shadow: 0 5px 10px rgba(0,0,0,0.05);
    
    /* [ì¶”ê°€] ê²€ìƒ‰ì°½ ì¸í’‹ê³¼ ë²„íŠ¼ ë†’ì´ ê°•ì œ í†µì¼ */
.rules-field .form-control, 
.rules-field .rules-field-text, 
.rules-field .btn {
    height: 50px !important; /* ë†’ì´ 50pxë¡œ í†µì¼ */
    border-radius: 0 !important; /* ë„¤ëª¨ ë°˜ë“¯í•˜ê²Œ (ì„ íƒì‚¬í•­, ë‘¥ê¸€ê²Œ í•˜ë ¤ë©´ ì‚­ì œ) */
}
/* ì–‘ìª½ ë ë‘¥ê¸€ê²Œ ì²˜ë¦¬ ë³µêµ¬ */
.rules-field .rules-field-text:first-child { border-top-left-radius: 8px !important; border-bottom-left-radius: 8px !important; }
.rules-field .btn:last-child { border-top-right-radius: 8px !important; border-bottom-right-radius: 8px !important; }
  }
</style>
</head>

<body>

<header id="header" class="fixed-top">
    <div class="container d-flex align-items-center justify-content-between">
      
      <div class="logo">
        <h1><a href="index.html" class="text-white">ìš©ì¸ëª¨ë‘ì˜í–‡ë¹›í˜‘ë™ì¡°í•©</a></h1>
      </div>

      <div class="d-flex align-items-center">
          
          <a href="index.html" class="fs-4 me-3 text-white" title="ë©”ì¸ìœ¼ë¡œ ì´ë™">
              <i class="bi bi-house-door"></i>
          </a>

          <a href="#" onclick="toggleSearch(event)" class="fs-4 text-white" title="ê·œì • ê²€ìƒ‰">
              <i class="bi bi-search"></i>
          </a>
          
      </div>

    </div>
  </header>

  <div id="search-overlay">
      <div class="container">
          <div class="input-group">
              <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-secondary"></i></span>
              <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ì°¾ìœ¼ì‹œëŠ” ì¡°í•­ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ì‚¬íšŒ, ì¡°í•©ì›)">
              <button class="btn btn-outline-secondary" onclick="toggleSearch(event)">ë‹«ê¸°</button>
          </div>
      </div>
  </div>

  <main class="container py-4" style="min-height: 80vh;">
    <main class="container py-4" style="min-height: 80vh; margin-top: 80px;">
    
    <div class="d-flex justify-content-center mb-4">
        <div class="btn-group shadow-sm" role="group" style="background:white; border-radius:30px; overflow:hidden; border:1px solid #e9ecef;">
            <button class="btn btn-lg px-4 py-2 active" id="btn-articles" onclick="switchRulesTab('articles')" 
                    style="border:none; border-radius:30px 0 0 30px; font-weight:bold; font-size:1rem;">ğŸ“œ ì •ê´€</button>
            <button class="btn btn-lg px-4 py-2" id="btn-bylaws" onclick="switchRulesTab('bylaws')" 
                    style="background:white; color:#666; border:none; border-radius:0 30px 30px 0; font-weight:bold; font-size:1rem;">âš–ï¸ ê·œì•½</button>
        </div>
    </div>

    <div id="view-articles">
        <div class="text-center mb-4">
            <h4 class="fw-bold text-dark">ì •ê´€ (Articles)</h4>
            <p class="text-muted small" id="articles-version">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        <div id="articles-container"></div>
        <div class="mt-5 pt-4 border-top">
            <h6 class="fw-bold text-muted mb-3 small">ì§€ë‚œ ê°œì • ì´ë ¥</h6>
            <div class="accordion" id="accordionArticles"></div>
        </div>
    </div>

    <div id="view-bylaws" style="display:none;">
        <div class="text-center mb-4">
            <h4 class="fw-bold text-dark">ìš´ì˜ ê·œì•½ (Bylaws)</h4>
            <p class="text-muted small" id="bylaws-version">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        <div id="bylaws-container"></div>
        <div class="mt-5 pt-4 border-top">
            <h6 class="fw-bold text-muted mb-3 small">ì§€ë‚œ ê°œì • ì´ë ¥</h6>
            <div class="accordion" id="accordionBylaws"></div>
        </div>
    </div>

  </main>

<footer id="footer" style="width: 100%; margin: 0; padding: 0;"></footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script src="footer.js"></script> 
  
  <script>
    const SUPABASE_URL = 'https://ifdqlwxgqgsvnawmhlfc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmZHFsd3hncWdzdm5hd21obGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxODQ3NDIsImV4cCI6MjA4Mjc2MDc0Mn0.UKUvMOl58KuDH24seC3oSgla7mK5lr-vXjqtpalnl6k';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    window.onload = async () => {
        // ëª¨ë°”ì¼ ë©”ë‰´ ì´ˆê¸°í™”
        initMobileMenu();

        await loadDocuments('ì •ê´€', 'articles');
        await loadDocuments('ê·œì•½', 'bylaws');
        
        document.getElementById('searchInput').addEventListener('input', filterContent);
        
        // URL í•´ì‹œ ì²´í¬ (#bylaws)
        if(window.location.hash === '#bylaws') {
            switchRulesTab('bylaws');
        }
    };

    // [ê¸°ëŠ¥] ê²€ìƒ‰ì°½ í† ê¸€
// [ìˆ˜ì •] ê²€ìƒ‰ì°½ í† ê¸€ ë° ì´ˆê¸°í™” ê¸°ëŠ¥
function toggleSearch(e) {
    if(e) e.preventDefault();
    const box = document.getElementById('search-overlay');
    const input = document.getElementById('searchInput');

    if (box.style.display === 'block') {
        // 1. ë‹«ì„ ë•Œ
        box.style.display = 'none';
        
        // â˜… í•µì‹¬: ê²€ìƒ‰ì–´ ì§€ìš°ê³  ì „ì²´ ëª©ë¡ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸°
        input.value = ''; 
        filterContent(); // ë¹ˆ ê°’ìœ¼ë¡œ í•„í„°ë§ -> ì „ì²´ ë³´ì„
    } else {
        // 2. ì—´ ë•Œ
        box.style.display = 'block';
        input.focus(); // ë°”ë¡œ ì…ë ¥ ê°€ëŠ¥í•˜ê²Œ í¬ì»¤ìŠ¤
    }
}

    // [ê¸°ëŠ¥] íƒ­ ì „í™˜ (Bootstrap íƒ­ ëŒ€ì‹  ì‹¬í”Œí•œ JS êµ¬í˜„ - ë” ì•ˆì •ì )
    function switchRulesTab(target) {
        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
        const btnA = document.getElementById('btn-articles');
        const btnB = document.getElementById('btn-bylaws');
        
        // ì»¨í…ì¸  ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°
        if (target === 'articles') {
            document.getElementById('view-articles').style.display = 'block';
            document.getElementById('view-bylaws').style.display = 'none';
            
            // ìŠ¤íƒ€ì¼ ì ìš© (í™œì„±: ë…¹ìƒ‰ë°°ê²½/í°ê¸€ì”¨, ë¹„í™œì„±: í°ë°°ê²½/íšŒìƒ‰ê¸€ì”¨)
            btnA.style.backgroundColor = '#009961'; btnA.style.color = '#fff'; btnA.classList.add('active');
            btnB.style.backgroundColor = '#fff'; btnB.style.color = '#666'; btnB.classList.remove('active');
        } else {
            document.getElementById('view-articles').style.display = 'none';
            document.getElementById('view-bylaws').style.display = 'block';
            
            btnB.style.backgroundColor = '#009961'; btnB.style.color = '#fff'; btnB.classList.add('active');
            btnA.style.backgroundColor = '#fff'; btnA.style.color = '#666'; btnA.classList.remove('active');
        }
        window.scrollTo(0,0);
    }

    // [ê¸°ëŠ¥] ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€ (index.html ë¡œì§ ì´ì‹)
    function initMobileMenu() {
        window.toggleMobileMenu = function() {
            const navbar = document.querySelector('#navbar');
            navbar.classList.toggle('navbar-mobile');
            const icon = document.querySelector('.mobile-nav-toggle');
            icon.classList.toggle('bi-list');
            icon.classList.toggle('bi-x'); 
        }
    }

    // ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    async function loadDocuments(keyword, typeId) {
        const { data } = await _supabase.from('site_documents')
            .select('*').eq('category', 'doc').ilike('title', `%${keyword}%`).order('event_date', {ascending: false});

        if (!data || data.length === 0) {
            document.getElementById(`${typeId}-container`).innerHTML = '<div class="text-center py-5 text-muted">ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        let currentDoc = data.find(d => d.is_current) || data[0];
        let pastDocs = data.filter(d => d.id !== currentDoc.id);

        if (currentDoc) {
            document.getElementById(`${typeId}-version`).innerText = `ì‹œí–‰ì¼: ${currentDoc.event_date} | ë²„ì „: ${currentDoc.version || 'Original'}`;
            renderCards(currentDoc.content, `${typeId}-container`);
        }

        const archiveBox = document.getElementById(typeId === 'articles' ? 'accordionArticles' : 'accordionBylaws');
        if (pastDocs.length > 0) {
            let html = '';
            pastDocs.forEach((doc, idx) => {
                const itemId = `${typeId}Arch${idx}`;
                html += `
                    <div class="accordion-item searchable-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${itemId}">
                                ${doc.title} <span class="archive-badge">${doc.event_date}</span>
                            </button>
                        </h2>
                        <div id="${itemId}" class="accordion-collapse collapse">
                            <div class="accordion-body bg-light">
                                <div class="archive-content" style="white-space: pre-wrap; font-size:0.9rem;">${doc.content}</div>
                            </div>
                        </div>
                    </div>`;
            });
            archiveBox.innerHTML = html;
        } else {
            archiveBox.innerHTML = '<div class="text-center text-muted small py-3">ì§€ë‚œ ê°œì • ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    }

    function renderCards(text, containerId) {
        const container = document.getElementById(containerId);
        if (!text) return;

        const lines = text.split('\n');
        let html = '';
        let buffer = ''; 
        let currentTitle = ''; 

        const chapterPattern = /^ì œ\s*\d+\s*ì¥/; 
        const addendaPattern = /^ë¶€\s*ì¹™/;       
        
        lines.forEach(line => {
            const trimmed = line.trim();
            if(!trimmed) return;

            if (chapterPattern.test(trimmed)) {
                if (currentTitle || buffer) flushCard();
                html += `<div class="chapter-title searchable-item">${trimmed}</div>`;
                return;
            }

            if (addendaPattern.test(trimmed)) {
                if (currentTitle || buffer) flushCard();
                html += `<div class="addenda-title searchable-item">${trimmed}</div>`;
                return;
            }

            if (trimmed.startsWith('ì œ') && trimmed.includes('ì¡°')) {
                if (currentTitle || buffer) flushCard();
                
                const splitIndex = trimmed.search(/(\(|\[|â‘ |1\.|ê°€\.)/);
                if (splitIndex > -1) {
                    const parenEnd = trimmed.indexOf(')');
                    if (parenEnd > -1 && parenEnd < trimmed.length - 1) {
                        currentTitle = trimmed.substring(0, parenEnd + 1).trim();
                        buffer = trimmed.substring(parenEnd + 1).trim();
                    } else {
                        currentTitle = trimmed; 
                        buffer = '';
                        const circleMatch = trimmed.search(/â‘ |â‘¡|â‘¢|â‘£|â‘¤|â‘¥|â‘¦|â‘§|â‘¨|â‘©/);
                        if (circleMatch > 0) {
                             currentTitle = trimmed.substring(0, circleMatch).trim();
                             buffer = trimmed.substring(circleMatch).trim();
                        }
                    }
                } else {
                    currentTitle = trimmed;
                    buffer = '';
                }
                return;
            }

            if (trimmed) {
                buffer += (buffer ? '<br>' : '') + trimmed;
            }
        });

        if (currentTitle || buffer) flushCard();

        function flushCard() {
            let formattedBody = buffer.replace(/(â‘ |â‘¡|â‘¢|â‘£|â‘¤|â‘¥|â‘¦|â‘§|â‘¨|â‘©)/g, '<br>$1');
            if(formattedBody.startsWith('<br>')) formattedBody = formattedBody.substring(4);

            html += `
            <div class="article-card searchable-item">
                ${currentTitle ? `<span class="article-title">${currentTitle}</span>` : ''}
                <div class="article-content">${formattedBody}</div>
            </div>`;
            
            currentTitle = '';
            buffer = '';
        }

        container.innerHTML = html;
    }

    function filterContent() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        const items = document.querySelectorAll('.searchable-item');

        items.forEach(item => {
            const collapseDiv = item.querySelector('.accordion-collapse');
            if (collapseDiv && !collapseDiv.classList.contains('show')) {
                item.style.display = ''; return; 
            }
            if (item.innerText.toLowerCase().includes(keyword)) item.style.display = '';
            else item.style.display = 'none';
        });
    }
  </script>
</body>
</html>
