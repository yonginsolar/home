<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>용인모두의햇빛협동조합</title>
  <meta content="용인 시민이 주인이 되는 태양광 발전소" name="description">
  <meta content="협동조합, 태양광, 재생에너지, 용인" name="keywords">

  <link rel="icon" type="image/png" href="https://ifdqlwxgqgsvnawmhlfc.supabase.co/storage/v1/object/public/assets/favicon.png">

  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.css" />
  
  <link href="https://cdn.jsdelivr.net/gh/webfontworld/gmarket/GmarketSans.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <link href="style.css" rel="stylesheet">
  <style>
    /* =========================================
   모바일 헤더 로그인/버튼 줄바꿈 방지 패치
   ========================================= */
@media (max-width: 991px) {
  /* 1. 우측 버튼 그룹 컨테이너: 줄바꿈 금지 및 간격 조절 */
  #header .d-flex.align-items-center {
    flex-wrap: nowrap;     /* 줄바꿈 원천 차단 */
    gap: 5px;              /* 요소 사이 간격 최소화 */
  }

  /* 2. 로그인 텍스트 링크 수정 */
  #header .d-flex.align-items-center > a[href="membermanage.html"] {
    font-size: 13px !important;    /* 글자 크기 미세 축소 */
    margin-right: 5px !important;  /* 기존 me-3(16px) -> 5px로 강제 축소 */
    white-space: nowrap;           /* 텍스트 줄바꿈 방지 */
  }

  /* 3. 조합원 가입 버튼 수정 */
  #header .get-started-btn {
    padding: 6px 12px !important;  /* 버튼 내부 여백 축소 */
    font-size: 13px !important;
    white-space: nowrap;           /* 텍스트 줄바꿈 방지 */
    margin-left: 0 !important;
  }

  /* 4. 햄버거 메뉴 아이콘 여백 수정 */
  #header .mobile-nav-toggle {
    margin-left: 5px !important;   /* 기존 ms-3(16px) -> 5px로 강제 축소 */
  }
  
  /* 5. 로고 폰트 사이즈도 너무 크면 줄바꿈 원인이 되므로 안전장치 */
  #header .logo h1 a {
    font-size: 18px; 
  }
}
  </style>
</head>

<body>

  <header id="header" class="fixed-top ">
<div class="container d-flex align-items-center justify-content-between"> <div class="logo">
    <h1><a href="index.html">용인모두의햇빛협동조합</a></h1>
  </div>

  <nav id="navbar" class="navbar">
    <ul>
      <li><a class="nav-link scrollto active" href="#hero">홈</a></li>
      <li><a class="nav-link scrollto" href="#about">소개</a></li>
      <li><a class="nav-link scrollto" href="#progress">건립현황</a></li> 
      <li><a class="nav-link scrollto" href="#status">발전현황</a></li>
      <li><a class="nav-link scrollto" href="#calculator">예상수익</a></li>
      <li><a class="nav-link scrollto" href="#documents">정보</a></li>
      <li><a class="nav-link scrollto" href="#partners">함께하는 단체</a></li>
      <li><a class="nav-link scrollto" href="#faq">FAQ</a></li>
      <li><a class="nav-link scrollto" href="#contact">문의하기</a></li>
    </ul>
  </nav>

<div class="d-flex align-items-center">
        <a href="membermanage.html" class="scrollto me-3" style="color: #fff; font-size: 14px; text-decoration: none;">로그인</a>
        <a href="signup.html" class="get-started-btn scrollto">조합원 가입</a> 
  
    <i class="bi bi-list mobile-nav-toggle d-lg-none ms-3" onclick="toggleMobileMenu()"></i>
  </div>

</div>
  </header>

  <section id="hero" class="d-flex align-items-center justify-content-center">
    <div class="container" data-aos="fade-up">

      <div class="row justify-content-center" data-aos="fade-up" data-aos-delay="150">
        <div class="col-xl-8 col-lg-8">
          <h1>용인의 햇빛으로 만드는<br><span>모두의 에너지</span></h1>

          
          <div class="d-flex justify-content-center gap-3">
             <a href="signup.html" class="btn-get-started scrollto">조합원 가입하기</a>

          </div>
        </div>
      </div>

    </div>
  </section>

  <main id="main">

<section id="about" class="about">
      <div class="container" data-aos="fade-up">

        <div class="section-title">
          <h2>About</h2>
          <p>조합 <span>소개</span></p>
        </div>

        <div class="row content">
          <div class="col-lg-6">
            <h3 id="about-title">우리는 햇빛으로 가치를 만듭니다</h3>
            <p class="fst-italic" id="about-subtitle">지속 가능한 미래를 위한 시민들의 자발적 선택</p>
            
            <ul id="about-list">
              <li><i class="bi bi-check2-all"></i> 시민 참여형 태양광 발전소 건립</li>
              <li><i class="bi bi-check2-all"></i> 투명한 수익 배분과 민주적 운영</li>
              <li><i class="bi bi-check2-all"></i> 지역 사회를 위한 에너지 나눔</li>
            </ul>
            
            <p id="about-content">
                용인모두의햇빛협동조합은 기후 위기에 대응하고 에너지 전환을 실현하기 위해 시민들이 모여 만든 협동조합입니다.
            </p>
          </div>

          <div class="col-lg-6 pt-4 pt-lg-0">
             <img src="assets/img/about.jpg" class="img-fluid" alt="" id="about-img-src" style="border-radius:8px; width:100%;">
          </div>
        </div>

      </div>
    </section>


<section id="impact" class="impact" style="background: linear-gradient(rgba(46, 125, 50, 0.9), rgba(46, 125, 50, 0.9)), url('https://images.unsplash.com/photo-1529156069898-49953e39b3ac?q=80&w=2069&auto=format&fit=crop') fixed center center; background-size: cover; padding: 80px 0; color: #fff;">
      <div class="container" data-aos="zoom-in">

        <div class="text-center mb-5">
          <h3 style="font-family:'GmarketSans'; font-size: 28px; margin-bottom:10px;">함께 만드는 변화</h3>
          <p style="opacity: 0.8;">시민의 힘이 모여 용인의 내일을 바꿉니다.</p>
        </div>

        <div class="row text-center justify-content-center">
          
          <div class="col-lg-5 col-md-6 mb-5 mb-lg-0">
            <div class="stat-box" style="border-right: 1px solid rgba(255,255,255,0.3);">
              <i class="bi bi-people-fill" style="font-size: 48px; color: var(--color-secondary); margin-bottom: 15px; display:block;"></i>
              
              <div style="font-size: 56px; font-weight: 700; font-family:'GmarketSans'; line-height:1;">
                <span id="stat-total-members" class="purecounter">0</span> <span style="font-size: 24px;">명</span>
              </div>
              
              <div class="mt-3" style="font-size: 16px; opacity: 0.9; background: rgba(0,0,0,0.2); display:inline-block; padding: 5px 20px; border-radius: 50px;">
                개인 <strong id="stat-ind-members">0</strong>명  
                단체 <strong id="stat-grp-members">0</strong>곳
              </div>
            </div>
          </div>

          <div class="col-lg-5 col-md-6">
            <div class="stat-box">
              <i class="bi bi-coin" style="font-size: 48px; color: #ffd700; margin-bottom: 15px; display:block;"></i>
              
              <div style="font-size: 56px; font-weight: 700; font-family:'GmarketSans'; line-height:1;">
                <span id="stat-total-amount" class="purecounter">0</span> <span style="font-size: 24px;">원</span>
              </div>

              <div class="mt-3" style="font-size: 16px; opacity: 0.9;">
                시민이 직접 투자한 <span style="color:var(--color-secondary); font-weight:bold;">에너지 자립 기금</span>
              </div>
            </div>
          </div>

        </div>

        <div class="text-center mt-5">
           <a href="signup.html" class="btn-get-started scrollto" style="border: 2px solid #fff; background: transparent; color: #fff; padding: 12px 30px; border-radius: 50px; font-weight: 600; transition: 0.3s;">
             저도 조합원이 되겠습니다 <i class="bi bi-arrow-right ms-2"></i>
           </a>
        </div>

      </div>
    </section>





<section id="progress" class="services section-bg" style="display:none;">
      <div class="container" data-aos="fade-up">
        <div class="section-title">
          <h2>Progress</h2>
          <p>발전소 <span>건립 현황</span></p>
        </div>
        <div class="row justify-content-center" id="progress-container">
            </div>
      </div>
    </section>
    
    
<section id="status" class="counts" style="background:#f6f9fe;">
      <div class="container" data-aos="fade-up">
        <div class="section-title">
          <h2>Dashboard</h2>
          <p>실시간 <span>발전 현황</span> (예시)</p>
        </div>

        <div class="row no-gutters">
          <div class="col-lg-3 col-md-6 d-md-flex align-items-md-stretch">
            <div class="count-box">
              <i class="bi bi-sun" style="color: #ffc107;"></i> <span data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="1" class="purecounter">0</span>
              <p><strong>오늘 발전량</strong> (kWh)</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 d-md-flex align-items-md-stretch">
            <div class="count-box">
              <i class="bi bi-battery-charging" style="color: var(--color-primary);"></i>
              <span data-purecounter-start="0" data-purecounter-end="4210" data-purecounter-duration="1" class="purecounter">0</span>
              <p><strong>누적 발전량</strong> (kWh)</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 d-md-flex align-items-md-stretch">
            <div class="count-box">
              <i class="bi bi-tree" style="color: #2e7d32;"></i>
              <span data-purecounter-start="0" data-purecounter-end="18" data-purecounter-duration="1" class="purecounter">0</span>
              <p><strong>심은 소나무</strong> (그루)</p>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 d-md-flex align-items-md-stretch">
            <div class="count-box">
              <i class="bi bi-activity" style="color: #ff5722;"></i>
              <span data-purecounter-start="0" data-purecounter-end="98" data-purecounter-duration="1" class="purecounter">0%</span>
              <p><strong>발전소 가동률</strong> (%)</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
<section id="portfolio" class="portfolio" style="background:#fff;">
      <div class="container" data-aos="fade-up">

        <div class="section-title">
          <h2>Our Plants</h2>
          <p>우리 <span>발전소 현황</span></p>
        </div>

        <div class="row">
          
          <div class="row" id="power-plants-container">
  </div>
      </div>
    </section>
    
    <section id="calculator" class="features">
      <div class="container" data-aos="fade-up">
        <div class="row">
          <div class="col-lg-6" data-aos="fade-right">
            <div class="section-title" style="text-align:left;">
              <h2>Simulator</h2>
              <p>나의 <span>예상 수익</span>은?</p>
            </div>
            <p style="font-size:1.1rem;">
              조합원이 되어 출자금을 납입하면, 발전 수익을 배당금으로 돌려드립니다.<br>
              <small class="text-muted">* 예상 수익률 연 5% 기준 (변동 가능)<br>* 배당은 총회 의결 및 경영성과에 따라 결정되며 없을 수 있습니다.<br>* 조합원 1인의 출자 금액은 총 출자 금액의 100분의 30(30%)을 넘을 수 없습니다.</small>
            </p>
          </div>
          
          <div class="col-lg-6" style="background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1);" data-aos="fade-left">
            <label for="investmentRange" class="form-label fw-bold">출자금 입력</label>
            <input type="range" class="form-range" min="100" max="5000" step="100" id="investmentRange" value="100" oninput="calculateYield()">
            
<div class="d-flex justify-content-between mb-3">
              <span>10만원</span> <span id="displayAmount" class="fw-bold fs-4 text-success">10만원</span>
              <span id="displayMaxLimit">5,000만원</span>
            </div>

            <hr>

<div class="text-center mt-4">
              <h4>매년 예상 배당금 <small class="text-muted" style="font-size:0.6em;">(세전)</small></h4>
              <h2 id="displayYield" style="color:var(--color-secondary); font-weight:800; font-family:'GmarketSans', sans-serif;">50,000원</h2>
              <p class="text-muted small">매월 약 <span id="displayMonthly">4,160</span>원</p> 
              
              <p class="text-muted" style="font-size: 0.8rem; margin-top: 10px;">
                <br>* 예시 수익률 기준이며, 배당소득세(15.4%) 및 지방소득세가 포함된 세전 금액입니다.
                <br>* 최대 금액은 현재 총 출자금 기준 최대 출자 가능 금액입니다.
              </p>
            </div>
            
            <div class="text-center mt-4">
              <a href="signup.html" class="get-started-btn" style="background:var(--color-primary); color:#fff; border:none;">이 금액으로 가입하기</a>
            </div>
          </div>
        </div>
      </div>
    </section>

<section id="documents" class="services">
  <div class="container" data-aos="fade-up">
    
    <div class="section-title">
      <h2>Archives</h2>
      <p>투명한 <span>정보 공개</span></p>
    </div>

    <div class="row">
      <div class="col-lg-4 col-md-6 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
        <div class="icon-box w-100 text-center p-4 border rounded-3 d-flex flex-column justify-content-center">
          <div class="icon mb-3"><i class="bi bi-file-earmark-text fs-1 text-success"></i></div>
          <h4><a href="rules.html#pills-articles">정관 (Articles)</a></h4>
          <p class="mb-4">조합 운영의 기본 원칙을 담은 정관입니다.</p>
          <div class="mt-auto">
             <a href="rules.html#pills-articles" target="_blank" class="btn btn-outline-success rounded-pill px-4">
               <i class="bi bi-scroll"></i> 정관 전체보기
             </a>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-6 d-flex align-items-stretch mt-4 mt-md-0" data-aos="zoom-in" data-aos-delay="200">
        <div class="icon-box w-100 text-center p-4 border rounded-3 d-flex flex-column justify-content-center">
          <div class="icon mb-3"><i class="bi bi-journal-check fs-1 text-success"></i></div>
          <h4><a href="rules.html#bylaws">운영 규약 (Bylaws)</a></h4>
          <p class="mb-4">이사회 및 총회 운영에 관한 세부 규정입니다.</p>
          <div class="mt-auto">
             <a href="rules.html#bylaws" target="_blank" class="btn btn-outline-success rounded-pill px-4">
               <i class="bi bi-gavel"></i> 규약 전체보기
             </a>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-12 d-flex align-items-stretch mt-4 mt-lg-0" data-aos="zoom-in" data-aos-delay="300">
        <div class="icon-box w-100 p-4 border rounded-3 d-flex flex-column">
          
          <div class="text-center mb-3">
             <div class="icon mb-2"><i class="bi bi-megaphone fs-1 text-success"></i></div>
             <h4>최근 공지사항</h4>
          </div>

          <ul id="recent-notices-list" class="list-unstyled flex-grow-1 mb-0 text-start">
             <li class="text-center py-4 text-muted">
                 <div class="spinner-border spinner-border-sm text-success" role="status"></div>
                 <div class="mt-2 small">불러오는 중...</div>
             </li>
          </ul>

          <div class="mt-3 text-center">
             <button onclick="openNoticeSearchModal()" class="btn btn-sm btn-outline-secondary rounded-pill px-4">
               더 보기 +
             </button>
          </div>

        </div>
      </div>

    </div>
  </div>
</section>
    

<section id="history" class="history">
      <div class="container" data-aos="fade-up">
        
        <div class="section-title">
          <h2>History</h2>
          <p>걸어온 <span>길</span></p>
        </div>

        <div class="row" id="history-container">
            <div class="text-center w-100 py-5">
                <div class="spinner-border text-secondary"></div>
            </div>
        </div>

      </div>
    </section>




<section id="partners" class="clients">
  <div class="container" data-aos="fade-up">

    <div class="section-title">
      <h2>Partners</h2>
      <p>함께하는 <span>단체들</span></p>
    </div>

    <div class="row g-3 g-lg-4 justify-content-center" id="partners-container">
       <div class="text-center py-5">
           <div class="spinner-border text-success" role="status"></div>
       </div>
    </div>

  </div>
          <div class="text-center mt-5">
           <a href="signup.html" class="btn-get-started scrollto" style="border: 2px solid #000; background: transparent; color: #000; padding: 12px 30px; border-radius: 50px; font-weight: 600; transition: 0.3s;">
             단체 조합원 가입하기 <i class="bi bi-arrow-right ms-2"></i>
           </a>
        </div>
</section>

<section id="faq" class="faq section-bg" style="background-color: #f6f9ff;">
  <div class="container" data-aos="fade-up">

    <div class="section-title">
      <h2>F.A.Q</h2>
      <p>자주 묻는 <span>질문</span></p>
    </div>

    <ul class="faq-list" id="faq-list-container">
       <div class="text-center py-5">
           <div class="spinner-border text-success" role="status"></div>
       </div>
    </ul>

  </div>
</section>

    <section id="contact" class="contact">
      <div class="container" data-aos="fade-up">
        <div class="section-title">
          <h2>Contact</h2>
          <p><span>문의</span>하기</p>
        </div>
        <div class="row justify-content-center">
          <div class="col-lg-4 text-center">
            <div class="info">
              <div class="email">
                <i class="bi bi-envelope"></i>
                <h4>Email:</h4>
                <p>yonginsolar@gmail.com</p>
              </div>
              <div class="phone mt-4">
                <i class="bi bi-phone"></i>
                <h4>Call:</h4>
                <p>010-2513-5736 (사무국장 김민호)</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

<footer id="footer"></footer>
<script src="assets/js/home_patch_note.js"></script>
  
<div class="modal fade" id="plantModal1" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">제1호 용인시민체육관 상세정보</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between">
              <span>설비용량</span> <strong>98.5 kW</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>설치년도</span> <strong>2024년 12월</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>패널종류</span> <span>양면형 모듈 (한화솔루션)</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>금일 발전시간</span> <strong class="text-success">4.2 시간</strong>
            </li>
          </ul>
          <div class="alert alert-light mt-3 text-center" role="alert">
            <i class="bi bi-check-circle-fill text-success"></i> 정상 가동 중입니다.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="plantModal2" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">제2호 기흥도서관 진행상황</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>현재 옥상 방수 공사 및 구조물 설치 작업이 진행 중입니다.</p>
          <div class="progress mb-3" style="height: 20px;">
            <div class="progress-bar bg-warning text-dark" role="progressbar" style="width: 60%">공정률 60%</div>
          </div>
          <ul class="list-group list-group-flush small">
             <li class="list-group-item">2025.01 구조물 입고 완료</li>
             <li class="list-group-item">2025.02 모듈 설치 예정</li>
             <li class="list-group-item">2025.03 상업 운전 개시 목표</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="plantModal3" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">제3호 수지구청 상세계획</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted">현재 부지 사용 협의 단계입니다.</p>
          <div class="alert alert-secondary text-center">
             조합원 모집이 완료되면<br>정식으로 추진될 예정입니다.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

<div class="modal fade" id="partnerDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
      
      <div class="modal-header border-0 pb-0 justify-content-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body text-center pt-0 pb-5 px-4">
        
        <div class="mb-3 d-flex align-items-center justify-content-center" style="height: 100px; overflow:hidden;">
            <img id="pt-modal-logo" src="" alt="Logo" class="img-fluid" style="max-height: 80px; display:none;">
            <h3 id="pt-modal-text-logo" class="fw-bold text-dark m-0" style="display:none; font-family:'GmarketSans'; word-break: keep-all;"></h3>
        </div>

        <div class="mb-2">
            <span id="pt-modal-name" class="fw-bold fs-5 text-dark"></span>
        </div>
        
        <hr class="w-25 mx-auto my-3" style="border-top: 2px solid var(--color-primary); opacity: 0.5;">

        <p id="pt-modal-desc" class="text-muted mb-4 fs-6" style="word-break: keep-all; line-height: 1.6;">
            </p>

        <div id="pt-modal-badges" class="d-flex flex-wrap justify-content-center gap-2 mb-4">
            </div>

        <a id="pt-modal-link" href="#" target="_blank" class="btn btn-dark rounded-pill px-4 py-2 fw-bold transition-link" style="display:none;">
            홈페이지 방문 <i class="bi bi-box-arrow-up-right ms-1"></i>
        </a>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="noticeDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg"> <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="notice-modal-title">공지사항 제목</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-between text-muted border-bottom pb-2 mb-3">
            <span id="notice-modal-cat" class="badge bg-secondary">분류</span>
            <small id="notice-modal-date">202X.XX.XX</small>
        </div>
        <div id="notice-modal-content" style="min-height: 200px; line-height: 1.6; word-break: keep-all;">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="plantDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="plant-modal-title">발전소 이름</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3 rounded overflow-hidden" style="max-height: 250px;">
             <img id="plant-modal-img" src="" class="w-100 h-100" style="object-fit:cover;" alt="발전소 전경">
        </div>
        
        <ul class="list-group list-group-flush" id="plant-modal-info-list">
           </ul>
        
        <div id="plant-modal-status-box" class="alert mt-3 text-center" role="alert">
        </div>
      </div>
      <div class="modal-footer">
        <a href="#" id="plant-modal-link" class="btn btn-success" target="_blank" style="display:none;">모니터링 보기</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="noticeSearchModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg"> <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold"><i class="bi bi-search me-2"></i>공지사항 검색</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div class="input-group mb-3">
          <input type="text" id="modal-search-input" class="form-control" placeholder="제목이나 내용을 입력하세요" onkeyup="filterNoticesInModal()">
          <button class="btn btn-outline-secondary" type="button"><i class="bi bi-search"></i></button>
        </div>

        <div style="max-height: 400px; overflow-y: auto;">
            <ul id="modal-notice-list" class="list-group list-group-flush">
               </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="noticeDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #f8f9fa;">
        <h5 class="modal-title fw-bold" id="notice-read-title">제목</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <div class="d-flex justify-content-between text-muted border-bottom pb-2 mb-4">
            <span id="notice-read-cat" class="badge bg-dark">공지</span>
            <small id="notice-read-date">202X.XX.XX</small>
        </div>
        <div id="notice-read-content" style="min-height: 200px; line-height: 1.8; color: #333;">
           </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-dark" onclick="openNoticeSearchModal()">목록으로</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>


  

  
  <script src="footer.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>

    // =================================================================
    // [4] 협력단체 (Partners) - 뱃지 시스템 연동 버전
    // =================================================================
    
    let g_partners_list = []; // 파트너 데이터 기억용
    let g_badge_def = [];     // 뱃지 정의(이름, 아이콘 등) 기억용
    
    let g_total_amount = 0;
    /* =================================================================
       1. 디자인/애니메이션 초기화 (AOS, Counter, Scroll)
       ================================================================= */
    AOS.init({ duration: 1000, easing: 'ease-in-out', once: true });
  //  new PureCounter();

    // 헤더 스크롤 효과
    const selectHeader = document.querySelector('#header');
    if (selectHeader) {
      const headerScrolled = () => {
        if (window.scrollY > 100) selectHeader.classList.add('header-scrolled');
        else selectHeader.classList.remove('header-scrolled');
      }
      window.addEventListener('load', headerScrolled);
      onscroll = document, headerScrolled;
    }

// ▲ 위 내용을 지우고 이 코드로 대체하세요 ▲
// [수정된 모바일 메뉴 토글 함수]
  function toggleMobileMenu() {
    const navbar = document.querySelector('#navbar');
    const toggleIcon = document.querySelector('.mobile-nav-toggle');
    
    // active 클래스를 껐다 켰다 함 (CSS에서 애니메이션 처리)
    navbar.classList.toggle('active');
    
    // 아이콘 변경 (햄버거 <-> X)
    toggleIcon.classList.toggle('bi-list');
    toggleIcon.classList.toggle('bi-x');
  }

  // [추가] 메뉴 바깥쪽(화면 아무데나) 클릭하면 닫기
  document.addEventListener('click', function(e) {
    const navbar = document.querySelector('#navbar');
    const toggleIcon = document.querySelector('.mobile-nav-toggle');

    // 메뉴가 열려있을 때만 실행
    if (navbar.classList.contains('active')) {
      // 클릭한 곳이 '햄버거 버튼'도 아니고 '메뉴 박스' 내부도 아니라면 닫음
      if (!toggleIcon.contains(e.target) && !navbar.contains(e.target)) {
        navbar.classList.remove('active');
        toggleIcon.classList.remove('bi-x');
        toggleIcon.classList.add('bi-list');
      }
    }
  });

    // 수익률 계산기
// [수정] 수익률 계산 (만원 단위 기준)
    function calculateYield() {
      const slider = document.getElementById('investmentRange');
      if(!slider) return;

      const rangeValue = Number(slider.value); // 슬라이더 값 (단위: 만원)
      
      // 화면 표시: "10만원", "1,500만원" 등
      document.getElementById('displayAmount').innerText = rangeValue.toLocaleString() + "만원";
      
      // 실제 계산 (원 단위로 변환)
      const principal = rangeValue * 10000; 
      const annualYield = principal * 0.05; // 연 5% 나중에 수정할 부분 (principal * 0.05) * 0.846; (100% - 15.4% = 84.6%)
      const monthlyYield = annualYield / 12;

      // 결과 표시
      document.getElementById('displayYield').innerText = Math.floor(annualYield).toLocaleString() + "원";
      document.getElementById('displayMonthly').innerText = Math.floor(monthlyYield).toLocaleString();
    }

    // 진행률 바 애니메이션
    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const progressBar = entry.target;
          const targetWidth = progressBar.getAttribute('aria-valuenow') + '%';
          progressBar.style.width = targetWidth;
          observer.unobserve(progressBar);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.progress-bar').forEach(bar => observer.observe(bar));


    /* =================================================================
       2. 슈퍼베이스 데이터 연동 (DB -> 홈페이지)
       ================================================================= */
    const SUPABASE_URL = 'https://ifdqlwxgqgsvnawmhlfc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmZHFsd3hncWdzdm5hd21obGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxODQ3NDIsImV4cCI6MjA4Mjc2MDc0Mn0.UKUvMOl58KuDH24seC3oSgla7mK5lr-vXjqtpalnl6k'; 
    const _client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 페이지 로드 완료 시 실행
document.addEventListener('DOMContentLoaded', async () => {
      // 1. 섹션 관리 (여기서 화면 구성을 바꿈 -> 높이 변경 발생)
      await manageSections();
      
      // 2. 1차 재측량 (섹션 숨긴 직후 바로 반영)
      AOS.refresh(); 

      // 3. 데이터 로드 (글자들이 채워짐 -> 높이 미세하게 변경)
      await fetchStats(); 
      await fetchPlants();    
      await fetchHistory();     
      await fetchPartners();    
      await fetchNotices();     
      await fetchFaqs();
      await fetchAbout();  // 소개 관련 불러오기
    });

    // ★ [핵심 추가] 사진까지 다 뜨고 나서 "최종 재측량"
    // (이걸 넣어야 인터넷 느린 곳에서도 정확하게 작동합니다)
    window.addEventListener('load', () => {
        AOS.refresh();
    });

    // [신규 기능] DB 설정에 따라 섹션과 메뉴를 끄고 켜는 함수
    async function manageSections() {
        const { data: sections, error } = await _client.from('site_sections').select('*');
        
        if (error || !sections) return;

        sections.forEach(sec => {
            // DB에서 is_visible이 false(거짓)인 경우
            if (sec.is_visible === false) {
                
                // 1. 본문 섹션 숨기기
                const sectionEl = document.getElementById(sec.id);
                if (sectionEl) {
                    sectionEl.style.display = 'none'; // 아예 안 보이게 처리
                }

                // 2. 헤더 메뉴 숨기기 (국장님 요청 사항)
                // href="#about" 같은 링크를 찾아서 그 부모(li)를 숨김
                const navLink = document.querySelector(`a[href="#${sec.id}"]`);
                if (navLink) {
                    // <li> 태그를 찾아서 숨겨야 줄바꿈 등이 안 깨짐
                    const navItem = navLink.closest('li'); 
                    if (navItem) navItem.style.display = 'none';
                }
            }
        });
    }

    // [1] 통계 데이터
// [1] 통계 데이터 (수정됨: 공개 함수 RPC 호출)
// [1] 통계 데이터 (업그레이드 버전)
async function fetchStats() {
      const { data: stats, error } = await _client.rpc('get_public_stats');

      if (stats) {
        // 전역 변수에 저장
        g_total_amount = stats.amount || 0;

        // 숫자와 콤마 설정 (HTML 속성에 값 주입)
        updateCounter('stat-total-members', stats.count);
        updateCounter('stat-total-amount', stats.amount);
        updateCounter('stat-ind-members', stats.ind_count);
        updateCounter('stat-grp-members', stats.grp_count);

        // ★ [수정됨] end: 100 삭제. 이제 HTML에 적힌 진짜 숫자로 작동함.
        new PureCounter({
            selector: '.purecounter', 
            duration: 1, 
            separator: true // 콤마 켜기
        });

        // 계산기 범위 설정 실행
        setupCalculator(g_total_amount);
      }
    }

/* =================================================================
   전역 변수 선언 (데이터 보관용)
   ================================================================= */

let g_plants_list = [];    // 모달 연결을 위해 발전소 전체 데이터 저장

/* =================================================================
   [기능 1] 공지사항 (Notices) - 검색 및 모달 구현
   ================================================================= */



// 2. 공지사항 화면 그리기 (검색 시 재사용됨)
function renderNotices(dataList) {
    const listContainer = document.getElementById('recent-notices-list');
    if(!listContainer) return;

    if(dataList.length === 0) {
        listContainer.innerHTML = '<li class="text-muted small text-center py-3">검색 결과가 없습니다.</li>';
        return;
    }

    let html = '';
    dataList.forEach(n => {
        // 카테고리별 뱃지 색상 구분
        const badgeClass = n.category === '공지' ? 'bg-primary' : (n.category === '뉴스' ? 'bg-success' : 'bg-secondary');
        const dateStr = n.created_at.split('T')[0].replaceAll('-', '.');
        
        // ★ 핵심: onclick에 ID를 넘겨서 모달을 엽니다. (alert 제거됨)
        html += `
          <li class="mb-2 d-flex align-items-center border-bottom pb-2">
             <span class="badge ${badgeClass} me-2" style="flex-shrink:0;">${n.category}</span> 
             <a href="javascript:void(0);" class="text-dark text-decoration-none text-truncate" 
                onclick="openNoticeDetail('${n.id}')" style="max-width: 60%; display:inline-block;">
                ${n.title}
             </a>
             <small class="text-muted ms-auto">${dateStr}</small>
          </li>
        `;
    });
    listContainer.innerHTML = html;
}

// 3. [검색 기능] 키보드 입력 시 실시간 필터링
function filterNotices() {
    const input = document.getElementById('notice-search-input');
    if(!input) return;

    const keyword = input.value.toLowerCase().trim(); // 소문자로 변환하여 비교

    // 제목(title) 또는 내용(content)에 검색어가 포함된 것만 필터링
    const filtered = g_notices_list.filter(n => {
        const titleMatch = n.title && n.title.toLowerCase().includes(keyword);
        const contentMatch = n.content && n.content.toLowerCase().includes(keyword);
        return titleMatch || contentMatch;
    });

    // 필터링된 결과로 다시 그리기 (최대 5개만 보여줄지, 전체 다 보여줄지는 선택)
    // 검색 중일 때는 사용자가 결과를 찾고 싶어 하므로 개수 제한 없이 보여주는 것이 UX상 좋습니다.
    renderNotices(filtered.length > 0 ? filtered : []); 
}

/* =================================================================
   [기능 1] 공지사항 (Notices) - 메인 노출 & 검색 모달 & 상세 모달
   ================================================================= */

// 데이터 보관용 전역 변수
let g_notices_list = []; 

// 1. 공지사항 데이터 가져오기 (최초 1회 실행)
async function fetchNotices() {
    // 넉넉하게 50개 가져옴
    const { data: notices, error } = await _client.from('coop_notices')
        .select('*')
        .eq('status', 'published')
        .order('created_at', { ascending: false })
        .limit(50);

    const mainList = document.getElementById('recent-notices-list');
    
    if (error || !notices || notices.length === 0) {
        if(mainList) mainList.innerHTML = '<li class="text-muted small text-center">등록된 글이 없습니다.</li>';
        return;
    }

    g_notices_list = notices;

    // [메인 화면]에는 최신 5개만 그리기
    renderMainNotices(notices.slice(0, 5));
}

// 2. 메인 화면 리스트 렌더링 (심플 버전)
function renderMainNotices(items) {
    const listEl = document.getElementById('recent-notices-list');
    if(!listEl) return;

    let html = '';
    items.forEach(n => {
        const badgeClass = n.category === '공지' ? 'bg-primary' : 'bg-secondary';
        const dateStr = n.created_at.split('T')[0].replaceAll('-', '.');
        
        // 클릭하면 바로 '상세 읽기 모달' 오픈
        html += `
          <li class="mb-2 d-flex align-items-center border-bottom pb-2" style="cursor:pointer;" onclick="openNoticeDetail('${n.id}')">
             <span class="badge ${badgeClass} me-2" style="flex-shrink:0; font-size:0.75rem;">${n.category}</span> 
             <span class="text-dark text-truncate" style="flex-grow:1; max-width: 180px;">${n.title}</span>
             <small class="text-muted ms-2" style="font-size:0.8rem;">${dateStr}</small>
          </li>
        `;
    });
    listEl.innerHTML = html;
}

// 3. [더 보기 버튼] 클릭 시 -> 검색 모달 열기
function openNoticeSearchModal() {
    // 1) 검색 모달 리스트에 전체 데이터 뿌리기
    renderModalList(g_notices_list);
    
    // 2) 검색창 초기화
    const input = document.getElementById('modal-search-input');
    if(input) input.value = '';

    // 3) 상세 모달이 열려있다면 닫고, 검색 모달 열기 (순서 중요)
    // 부트스트랩 모달 인스턴스 가져오기
    const detailEl = document.getElementById('noticeDetailModal');
    const searchEl = document.getElementById('noticeSearchModal');
    
    const detailModal = bootstrap.Modal.getInstance(detailEl);
    if(detailModal) detailModal.hide(); // 상세창 닫기

    const searchModal = new bootstrap.Modal(searchEl);
    searchModal.show(); // 검색창 열기
}

// 4. 검색 모달 내부 리스트 렌더링
function renderModalList(items) {
    const modalList = document.getElementById('modal-notice-list');
    if(!modalList) return;

    if(items.length === 0) {
        modalList.innerHTML = '<div class="text-center py-3 text-muted">검색 결과가 없습니다.</div>';
        return;
    }

    let html = '';
    items.forEach(n => {
        const dateStr = n.created_at.split('T')[0];
        // 클릭 시 '상세 읽기 모달'로 이동
        html += `
          <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" 
              onclick="openNoticeDetail('${n.id}')" style="cursor:pointer;">
             <div>
                <span class="badge bg-light text-dark border me-1">${n.category}</span>
                <span class="fw-bold text-dark">${n.title}</span>
             </div>
             <small class="text-muted">${dateStr}</small>
          </li>
        `;
    });
    modalList.innerHTML = html;
}

// 5. [검색 기능] 모달 내부에서 타이핑 할 때
function filterNoticesInModal() {
    const input = document.getElementById('modal-search-input');
    const keyword = input.value.toLowerCase().trim();

    const filtered = g_notices_list.filter(n => {
        const t = n.title ? n.title.toLowerCase() : '';
        const c = n.content ? n.content.toLowerCase() : '';
        return t.includes(keyword) || c.includes(keyword);
    });

    renderModalList(filtered);
}

// 6. [상세 보기] 글 클릭 시 -> 상세 모달 오픈
function openNoticeDetail(id) {
    const n = g_notices_list.find(item => item.id === id);
    if(!n) return;

    // 1) 내용 채우기
    document.getElementById('notice-read-title').innerText = n.title;
    document.getElementById('notice-read-cat').innerText = n.category;
    document.getElementById('notice-read-date').innerText = n.created_at.split('T')[0];
    
    // 줄바꿈 처리
    const contentHtml = n.content ? n.content.replace(/\n/g, '<br>') : '';
    document.getElementById('notice-read-content').innerHTML = contentHtml;

    // 2) 검색 모달이 열려있으면 닫기 (중첩 방지)
    const searchEl = document.getElementById('noticeSearchModal');
    const searchModal = bootstrap.Modal.getInstance(searchEl);
    if(searchModal) searchModal.hide();

    // 3) 상세 모달 열기
    const detailModal = new bootstrap.Modal(document.getElementById('noticeDetailModal'));
    detailModal.show();
}


/* =================================================================
   [기능 2] 발전소 (Power Plants) - 완전 동적화 & 단일 모달
   ================================================================= */

// 1. 발전소 데이터 로드 및 분배
async function fetchPlants() {
    const { data, error } = await _client.from('site_power_plants').select('*').order('display_order');
    
    if(error || !data) return;

    // 전역 변수에 저장 (모달에서 쓰기 위함)
    g_plants_list = data;

    // 1) [Portfolio 섹션] - '운영중'인 발전소만 카드 형태로 표시
    // HTML ID가 'power-plants-container' 인지 'portfolio-container' 인지 확인 필요.
    // 사용자가 주신 HTML에는 id="power-plants-container"가 내부에 있습니다.
    const pfContainer = document.getElementById('power-plants-container'); 
    
    if(pfContainer) {
        const operatingPlants = data.filter(p => p.status === '운영중');
        
        if(operatingPlants.length === 0) {
            pfContainer.innerHTML = '<div class="col-12 text-center py-5">현재 운영 중인 발전소가 없습니다.</div>';
        } else {
            let pfHtml = '';
            operatingPlants.forEach(p => {
                 // 이미지가 없으면 플레이스홀더 사용
                 const imgUrl = p.image_url || 'https://via.placeholder.com/800x600?text=Solar+Plant';
                 
                 pfHtml += `
                  <div class="col-lg-4 col-md-6 portfolio-item mb-4" data-aos="fade-up">
                    <div class="portfolio-wrap shadow-sm rounded overflow-hidden">
                      <div style="height:250px; overflow:hidden;">
                        <img src="${imgUrl}" class="img-fluid w-100 h-100" style="object-fit:cover;" alt="${p.name}">
                      </div>
                      <div class="portfolio-info p-3 bg-white">
                        <h4 class="fw-bold text-dark">${p.name}</h4>
                        <p class="text-muted small mb-2">${p.capacity}kW | ${p.location || '용인시'}</p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <span class="badge bg-success">정상 가동 중</span>
                            <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="openPlantDetail('${p.id}')">
                                <i class="bi bi-plus-lg"></i> 상세 정보
                            </button>
                        </div>
                      </div>
                    </div>
                  </div>`;
            });
            pfContainer.innerHTML = pfHtml;
        }
    }

    // 2) [Progress 섹션] - '건립 추진 중' 등 나머지 발전소 표시 (기존 함수 재사용)
    // renderProgressSection 함수는 기존에 만드신 것을 그대로 둡니다.
    // 단, 데이터가 g_plants_list에 있으므로 그대로 넘겨줍니다.
    if(typeof renderProgressSection === 'function') {
        renderProgressSection(data);
    }
}

// 2. [상세 모달] 발전소 상세 정보 팝업
function openPlantDetail(id) {
    const p = g_plants_list.find(item => item.id === id);
    if(!p) return;

    // 1) 기본 정보 채우기
    document.getElementById('plant-modal-title').innerText = p.name;
    
    const imgEl = document.getElementById('plant-modal-img');
    imgEl.src = p.image_url || 'https://via.placeholder.com/800x400?text=No+Image';

    // 2) 리스트 구성 (동적으로 생성)
    const listContainer = document.getElementById('plant-modal-info-list');
    let listHtml = `
        <li class="list-group-item d-flex justify-content-between">
          <span>설비 용량</span> <strong>${p.capacity} kW</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>위치</span> <span>${p.location || '-'}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>진행 상태</span> <strong class="text-primary">${p.status}</strong>
        </li>
    `;
    
    // 완공일이 있으면 추가
    if(p.completion_date) {
        listHtml += `
        <li class="list-group-item d-flex justify-content-between">
          <span>준공일(예정)</span> <strong>${p.completion_date}</strong>
        </li>`;
    }
    listContainer.innerHTML = listHtml;

    // 3) 상태 메시지 박스 및 버튼 처리
    const statusBox = document.getElementById('plant-modal-status-box');
    const linkBtn = document.getElementById('plant-modal-link');

    if(p.status === '운영중') {
        statusBox.className = "alert alert-success text-center";
        statusBox.innerHTML = '<i class="bi bi-check-circle-fill"></i> 현재 정상적으로 전력을 생산하고 있습니다.';
        
        // 모니터링 링크가 있으면 버튼 활성화
        if(p.monitor_url) {
            linkBtn.href = p.monitor_url;
            linkBtn.style.display = 'inline-block';
            linkBtn.innerText = '실시간 발전량 모니터링';
        } else {
            linkBtn.style.display = 'none';
        }
    } else {
        // 공사 중 등 다른 상태
        statusBox.className = "alert alert-warning text-center";
        const progressRate = p.progress_rate || 0;
        statusBox.innerHTML = `<i class="bi bi-tools"></i> 현재 진행률 <strong>${progressRate}%</strong> 입니다.`;
        
        linkBtn.style.display = 'none'; // 공사 중엔 모니터링 없음
    }

    // 모달 띄우기
    new bootstrap.Modal(document.getElementById('plantDetailModal')).show();
}

    // [수정] 건립 현황 (Progress) 그리기 함수
// [수정] 건립 현황 그리기 (디자인 업그레이드 & 단계별 표시)
// [수정] 건립 현황 그리기 (국장님 요청 디자인 + 단계별 활성화)
    function renderProgressSection(allPlants) {
        const inProgressPlants = allPlants.filter(p => p.status !== '운영중');
        const section = document.getElementById('progress');
        const container = document.getElementById('progress-container');
        
        if (!section || !container) return;

        if (inProgressPlants.length === 0) {
            section.style.display = 'none';
            return;
        }

        section.style.display = 'block';
        
        let html = '';
        inProgressPlants.forEach(p => {
            const rate = p.progress_rate || 0;
            const img = p.image_url || 'https://via.placeholder.com/800x400?text=No+Image';
            
            // 단계 계산
            const s1 = rate >= 0 ? 'active' : '';   const c1 = (rate >= 0 && rate < 20) ? 'current' : '';
            const s2 = rate >= 20 ? 'active' : '';  const c2 = (rate >= 20 && rate < 40) ? 'current' : '';
            const s3 = rate >= 40 ? 'active' : '';  const c3 = (rate >= 40 && rate < 60) ? 'current' : '';
            const s4 = rate >= 60 ? 'active' : '';  const c4 = (rate >= 60 && rate < 80) ? 'current' : '';
            const s5 = rate >= 80 ? 'active' : '';  const c5 = (rate >= 80) ? 'current' : '';

            // 상태 텍스트
            let statusText = "건립 추진 중";
            if(c1) statusText = "조합 설립 및 초기 준비";
            else if(c2) statusText = "발전소 부지 선정 중";
            else if(c3) statusText = "인허가 절차 진행 중";
            else if(c4) statusText = "발전소 착공 및 공사 중";
            else if(c5) statusText = "완공 및 설비 점검 중";

            html += `
            <div class="col-lg-8 col-md-10 mb-5" data-aos="fade-up">
                <div class="count-box" style="padding: 30px; background: #fff; box-shadow: 0 0 30px rgba(0,0,0,0.08); border-radius: 8px;">
                  
                  <div class="row align-items-center">
                      <div class="col-md-5 mb-3 mb-md-0">
                          <div style="height:200px; border-radius:8px; overflow:hidden; border:1px solid #eee;">
                              <img src="${img}" style="width:100%; height:100%; object-fit:cover;">
                          </div>
                      </div>
                      <div class="col-md-7">
                          <div class="d-flex align-items-center mb-2">
                              <span class="badge bg-warning text-dark me-2">${p.status}</span>
                              <h3 style="font-weight: 700; font-size: 1.5rem; margin:0;">${p.name}</h3>
                          </div>
                          
                          <ul class="list-unstyled text-muted small mb-3">
                              <li><i class="bi bi-geo-alt me-1"></i> 위치: ${p.location || '미정'}</li>
                              <li><i class="bi bi-aspect-ratio me-1"></i> 면적: ${p.area || '-'}</li>
                              <li><i class="bi bi-lightning-charge me-1"></i> 용량(예정): ${p.capacity}kW</li>
                              <li><i class="bi bi-calendar-check me-1"></i> 준공(예정): ${p.completion_date || '미정'}</li>
                          </ul>

                          <p class="mb-2 fw-bold text-dark" style="font-size:1.1rem;">${statusText}</p>
                          
                          <div class="progress" style="height: 25px; border-radius: 15px; background-color: #f1f3f5;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" 
                                 style="width: ${rate}%; font-size: 14px; font-weight:bold;" 
                                 aria-valuenow="${rate}" aria-valuemin="0" aria-valuemax="100">
                                 진행률 ${rate}%
                            </div>
                          </div>
                      </div>
                  </div>

                  <div class="d-flex justify-content-between step-container mt-4">
                    <div class="step-item ${s1} ${c1}">조합설립</div>
                    <div class="step-item ${s2} ${c2}">부지선정</div>
                    <div class="step-item ${s3} ${c3}">인허가</div> 
                    <div class="step-item ${s4} ${c4}">착공</div>
                    <div class="step-item ${s5} ${c5}">완공</div>
                  </div>
                </div>
            </div>`;
        });
        container.innerHTML = html;
        setTimeout(() => AOS.refresh(), 100);
    }

    // [3] 연혁
// [3] 연혁 (수정됨: 심부름꾼 함수 호출 방식)
// [3] 연혁 (더 보기 기능 적용)
    async function fetchHistory() {
      const container = document.getElementById('history-container');
      if(!container) return;

      // 1. 데이터 가져오기
      const { data: docs, error } = await _client.rpc('get_public_history');
      
      if (error || !docs || docs.length === 0) {
        container.innerHTML = '<div class="col-12 text-center text-muted py-3">등록된 연혁이 없습니다.</div>';
        return;
      }
      
      // 2. 보여줄 개수 설정 (기본 3개)
      const INITIAL_SHOW = 3;
      const visibleDocs = docs.slice(0, INITIAL_SHOW); // 앞의 3개
      const hiddenDocs = docs.slice(INITIAL_SHOW);     // 나머지 전부
      
      let html = '';

      // 3-1. [기본 노출] 앞의 3개 렌더링
      visibleDocs.forEach(doc => {
        html += createHistoryItemHtml(doc);
      });

      // 3-2. [숨김 영역] 나머지가 있다면 숨겨진 박스에 담기
      if (hiddenDocs.length > 0) {
        html += `<div id="history-hidden-area" style="display:none;">`;
        hiddenDocs.forEach(doc => {
            html += createHistoryItemHtml(doc);
        });
        html += `</div>`;

        // 3-3. [더 보기 버튼] 추가
        html += `
            <div id="history-more-btn" class="text-center mt-4">
                <button class="btn btn-outline-secondary rounded-pill px-4" onclick="toggleHistoryMore()">
                    연혁 더 보기 <i class="bi bi-chevron-down ms-1"></i>
                </button>
            </div>
        `;
      }

      container.innerHTML = html;
    }

    // [보조 함수] 연혁 아이템 HTML 생성기 (코드 중복 방지)
// [보조 함수] 연혁 아이템 HTML 생성기 (스마트 포맷팅 적용)
    function createHistoryItemHtml(doc) {
        // ★ 여기서 텍스트를 HTML로 예쁘게 변환합니다.
        const formattedContent = formatTextToHtml(doc.content);

        return `
          <div class="col-lg-8 offset-lg-2" data-aos="fade-up"> 
            <div class="timeline-item">
              <div class="timeline-date">${doc.event_date.replaceAll('-','.')}</div>
              <div class="timeline-content">
                <h4>${doc.title}</h4>
                ${formattedContent ? `<div class="text-muted">${formattedContent}</div>` : ''}
              </div>
            </div>
          </div>
        `;
    }

    // [신규 함수] 텍스트 -> HTML 변환기
    // 1. 엔터는 <br>로 바꿈
    // 2. '-'나 '•'로 시작하면 목록(li)으로 바꿈
    function formatTextToHtml(text) {
        if (!text) return '';
        
        const lines = text.split('\n'); // 줄 단위로 쪼개기
        let html = '';
        let inList = false; // 현재 목록을 만들고 있는지 체크

        lines.forEach(line => {
            line = line.trim();
            
            // '-' 또는 '•'로 시작하면 목록으로 간주
            if (line.startsWith('-') || line.startsWith('•')) {
                if (!inList) {
                    html += '<ul class="mb-0 ps-3">'; // 리스트 시작
                    inList = true;
                }
                // 앞의 특수문자 빼고 내용만 넣기
                html += `<li>${line.substring(1).trim()}</li>`;
            } else {
                // 목록이 끝났으면 닫아줌
                if (inList) {
                    html += '</ul>';
                    inList = false;
                }
                
                // 빈 줄이 아니면 출력 (엔터 처리)
                if (line !== '') {
                   html += `${line}<br>`;
                }
            }
        });

        if (inList) html += '</ul>'; // 마지막에 리스트가 열려있으면 닫음
        return html;
    }

    // [기능 함수] 더 보기 버튼 클릭 시 실행
    function toggleHistoryMore() {
        // 숨겨진 영역을 보여줌
        const hiddenArea = document.getElementById('history-hidden-area');
        if(hiddenArea) {
            hiddenArea.style.display = 'block';
            
            // 자연스럽게 나타나도록 애니메이션 효과 (선택사항)
            hiddenArea.style.animation = 'fadeIn 0.5s';
        }

        // 버튼은 이제 필요 없으니 숨김
        const btn = document.getElementById('history-more-btn');
        if(btn) btn.style.display = 'none';

        // ★ 화면 길이가 늘어났으니 AOS(스크롤 애니메이션) 위치 재계산
        setTimeout(() => AOS.refresh(), 100);
    }






// [보조 함수] 숫자 애니메이션 및 쉼표 찍기
// [헬퍼 함수] 숫자 업데이트 + 콤마 설정
    function updateCounter(id, target) {
      const el = document.getElementById(id);
      if(el) {
        // 1. 일단 콤마 찍어서 화면에 보여줌 (애니메이션 로딩 전 깜빡임 방지)
        el.innerText = Number(target).toLocaleString();
        
        // 2. 애니메이션 라이브러리용 설정
        el.setAttribute('data-purecounter-start', 0);
        el.setAttribute('data-purecounter-end', target);
        el.setAttribute('data-purecounter-duration', 1);
        el.setAttribute('data-purecounter-separator', 'true'); // ★ 콤마 켜기
      }
    }
    // [추가할 함수] 계산기 초기 설정 (최소 10만원 ~ 최대 30%)
// [수정] 계산기 초기 설정 (최소 10만원 ~ 최대 30%)
// [수정] 계산기 초기 설정 (자동 확장 + 억 단위 표시)
    function setupCalculator(totalAmount) {
        const slider = document.getElementById('investmentRange');
        const maxLabel = document.getElementById('displayMaxLimit'); 
        
        if(!slider) return;

        // 1. 최대 한도 계산 (총액의 30%, 데이터 없으면 기본 5,000만원)
        // 국장님 말씀대로 총액이 커지면 이 금액도 무제한으로 커집니다.
        const maxLimitWon = totalAmount > 0 ? (totalAmount * 0.3) : 50000000;
        
        // 2. 만원 단위로 변환 (슬라이더 내부용)
        const maxLimitMan = Math.floor(maxLimitWon / 10000); 

        // 3. 슬라이더 설정
        slider.min = 10;        // 최소 10만원
        slider.max = maxLimitMan; 
        slider.step = 1;        // 1만원 단위
        slider.value = 10;      // 시작값 10만원

        // 4. 화면 오른쪽 끝 숫자 표시 (억 단위 처리)
        if(maxLabel) {
            // 1억 미만이면 '5,000만원'
            // 1억 이상이면 '3억 5,000만원' 처럼 보이게 처리
            if (maxLimitWon >= 100000000) {
                const eok = Math.floor(maxLimitWon / 100000000);
                const man = Math.floor((maxLimitWon % 100000000) / 10000);
                maxLabel.innerText = `${eok}억 ${man > 0 ? man.toLocaleString() : ''}만원`; // 예: 30억 5,000만원
            } else {
                maxLabel.innerText = Number(maxLimitMan).toLocaleString() + "만원";
            }
        }

        // 5. UI 업데이트 실행
        calculateYield();
    }
    // DOMContentLoaded 안에 추가: await fetchAbout();

    // [신규] About 섹션 데이터 로드
// [수정] About 섹션 데이터 로드 (전체 HTML 허용 모드)
// [수정] About 섹션 데이터 로드 (샘플 강제 삭제 버전)
// [수정] About 데이터 로드 (점 삭제 + 아이콘 강제 삭제 버전)
    async function fetchAbout() {
        const { data } = await _client.from('site_about').select('*').single();
        const defaultData = data || { title:'', subtitle:'', content:'', list_items:'', image_url:'' };

        // 1. 이미지
        const imgEl = document.getElementById('about-img-src');
        if(imgEl) {
            imgEl.src = defaultData.image_url || '';
            imgEl.style.display = defaultData.image_url ? 'block' : 'none';
        }

        // 2. 텍스트
        const titleEl = document.getElementById('about-title');
        if(titleEl) titleEl.innerHTML = defaultData.title || '';

        const subEl = document.getElementById('about-subtitle');
        if(subEl) subEl.innerHTML = defaultData.subtitle || ''; 

        const contentEl = document.getElementById('about-content');
        if(contentEl) contentEl.innerHTML = defaultData.content || '';

        // 3. 리스트 (검은 점 제거 & 순수 텍스트 모드)
        const listEl = document.getElementById('about-list');
        if(listEl) {
            // ★ 핵심 1: 'list-unstyled' 클래스 추가 (검은 점 제거)
            listEl.className = "list-unstyled mb-3"; 
            
            if (!defaultData.list_items) {
                listEl.innerHTML = ''; 
                listEl.style.display = 'none';
            } else {
                listEl.style.display = 'block';
                
                if (defaultData.list_items.includes('<li')) {
                    // HTML 직접 입력 시
                    listEl.innerHTML = defaultData.list_items;
                } else {
                    // 줄바꿈 입력 시 -> ★ 핵심 2: 아이콘(<i>) 없이 깔끔하게 글자만 넣음
                    let html = '';
                    const items = defaultData.list_items.split('\n');
                    items.forEach(item => {
                        if(item.trim()) {
                            // <li> 안에 그냥 텍스트만 넣음 (점도 없고 아이콘도 없음)
                            html += `<li class="mb-2">${item.trim()}</li>`;
                        }
                    });
                    listEl.innerHTML = html;
                }
            }
        }
    }
// =================================================================
    // [기능] 협력단체 (Partners) 로드 & 모달 제어
    // =================================================================
    

    async function fetchPartners() {
       const container = document.getElementById('partners-container');
       if(!container) return;

       // 1. 뱃지 정보 로드
       const { data: badges } = await _client.from('site_badges').select('*');
       g_badge_def = badges || [];

       // 2. 파트너 데이터 로드 (승인된 것만)
       const { data: partners, error } = await _client
           .from('site_partners')
           .select('*')
           .eq('status', 'active') 
           .order('display_order', { ascending: true });

       if (error || !partners || partners.length === 0) {
           container.innerHTML = '<div class="col-12 text-center py-5 text-muted">등록된 협력 단체가 없습니다.</div>';
           return;
       }

       g_partners_list = partners;
       let html = '';
       
       partners.forEach(p => {
           // 리스트 화면: 로고 있으면 이미지, 없으면 텍스트
           const content = p.logo_url 
               ? `<img src="${p.logo_url}" class="img-fluid" alt="${p.name}">` 
               : `<span class="partner-text">${p.name}</span>`;

           // ★ 카드 디자인 적용 (col-6 col-md-4 col-lg-3 + partner-card 클래스)
           html += `
            <div class="col-6 col-md-4 col-lg-3">
                <div class="partner-card" onclick="openPartnerDetail('${p.id}')">
                    ${content}
                </div>
            </div>
           `;
       });
       
       container.innerHTML = html;
    }

    // [상세 모달 열기]
    function openPartnerDetail(id) {
        const p = g_partners_list.find(item => item.id == id);
        if(!p) return;

        const imgEl = document.getElementById('pt-modal-logo');
        const textLogoEl = document.getElementById('pt-modal-text-logo');
        const nameEl = document.getElementById('pt-modal-name');

        // ★ 핵심 로직: 로고가 있으면 -> 이미지만 크게, 텍스트 로고 숨김
        //              로고가 없으면 -> 텍스트 로고 크게 보여줌
        if(p.logo_url) {
            imgEl.src = p.logo_url;
            imgEl.style.display = 'block';
            textLogoEl.style.display = 'none';
        } else {
            imgEl.style.display = 'none';
            textLogoEl.innerText = p.name;
            textLogoEl.style.display = 'block';
        }

        // 하단 단체명 (보조 텍스트)
        nameEl.innerText = p.name;

        // 설명
        document.getElementById('pt-modal-desc').innerText = p.description || '함께하는 든든한 파트너입니다.';

        // 뱃지 렌더링
        const badgeContainer = document.getElementById('pt-modal-badges');
        badgeContainer.innerHTML = '';

        if(p.badges && p.badges.length > 0) {
            p.badges.forEach(bCode => {
                const bDef = g_badge_def.find(def => def.code === bCode);
                if(bDef) {
                    // 뱃지 디자인
                    badgeContainer.innerHTML += `
                        <span class="badge rounded-pill border px-3 py-2 d-flex align-items-center gap-1"
                              style="background-color: var(--bs-${bDef.color}-bg-subtle); color: var(--bs-${bDef.color}-text-emphasis); border-color: var(--bs-${bDef.color}-border-subtle) !important;">
                            <span style="font-size:1.1em;">${bDef.icon || ''}</span> ${bDef.name}
                        </span>
                    `;
                }
            });
        }

        // 링크 버튼
        const linkBtn = document.getElementById('pt-modal-link');
        if(p.link_url) {
            linkBtn.href = p.link_url;
            linkBtn.style.display = 'inline-block';
        } else {
            linkBtn.style.display = 'none';
        }

        new bootstrap.Modal(document.getElementById('partnerDetailModal')).show();
    }
    // =================================================================
    // [기능] FAQ 데이터 로드 (카드형 아코디언)
    // =================================================================
    async function fetchFaqs() {
       const container = document.getElementById('faq-list-container');
       if(!container) return;

       // 1. DB에서 공개된(is_visible=true) FAQ만 가져오기
       const { data: faqs, error } = await _client
           .from('site_faqs')
           .select('*')
           .eq('is_visible', true)
           .order('display_order', { ascending: true });

       if (error || !faqs || faqs.length === 0) {
           container.innerHTML = '<div class="text-center text-muted py-5">등록된 질문이 없습니다.</div>';
           return;
       }

       let html = '';
       
       // 2. 카드 HTML 생성 (Bootstrap Collapse 활용)
       faqs.forEach((f, index) => {
           // 줄바꿈 처리 (\n -> <br>)
           const answerHtml = f.answer ? f.answer.replace(/\n/g, '<br>') : '';
           
           html += `
            <li data-aos="fade-up" data-aos-delay="${index * 100}">
                <div class="question-block" data-bs-toggle="collapse" data-bs-target="#faq-content-${f.id}" aria-expanded="false" onclick="toggleFaqCard(this)">
                    <div class="d-flex align-items-center">
                        <span class="q-icon">Q.</span>
                        <span>[${f.category}] ${f.question}</span>
                    </div>
                    <i class="bi bi-chevron-down toggle-icon"></i>
                </div>

                <div id="faq-content-${f.id}" class="collapse answer-block" data-bs-parent="#faq-list-container">
                    <p class="mb-0 mt-2">
                        ${answerHtml}
                    </p>
                </div>
            </li>
           `;
       });
       
       container.innerHTML = html;
    }

    // [보조] 클릭 시 카드 스타일 활성화 (테두리 색상 등 변경)
    function toggleFaqCard(element) {
        // 모든 리스트의 active 클래스 제거 (하나만 열리게 할 경우)
        const allItems = document.querySelectorAll('.faq-list li');
        const parentLi = element.parentElement;

        // 이미 열려있는 걸 눌렀는지 확인
        const wasActive = parentLi.classList.contains('active');

        // 일단 다 닫는 스타일로 초기화
        allItems.forEach(li => li.classList.remove('active'));

        // 방금 누른 게 닫혀있던 거라면 -> 활성화 (열림)
        if (!wasActive) {
            parentLi.classList.add('active');
        }
    }
  </script>
</body>
</html>
